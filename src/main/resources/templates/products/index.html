<!DOCTYPE html>
<html
  lang="en"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout/erp}"
>
  <head>
    <title>Products - Overview</title>
    <script>
      document.addEventListener(
        "DOMContentLoaded",
        () =>
          (document.getElementById("header-route").innerHTML = `
        <p>Products / <span class="active">Overview</span></p>`)
      );
    </script>
    <script th:inline="javascript">
      const rows = /*[[${data}]]*/ [];

      const Row = (name, ref, price, isForSale) => `
        <tr onclick="handleRowClick(${ref})">
          <td>${name}</td>
          <td># ${ref}</td>
          <td>$ ${price}</td>
          <td align="right">
            <span
              class="${
                isForSale ? "badge badge-positive" : "badge badge-negative"
              }"
            >${isForSale ? "For Sale" : "Not For Sale"}</span>
          </td>
        </tr>
      `;

      const setTableRows = (rows) => {
        document.getElementById("table-data").innerHTML = rows
          .map((row) => Row(row.name, row.ref, row.price, row.isForSale))
          .join("");
      };

      const handleRowClick = (ref) => {
        const route = _routes.find((i) => i.name === "Products").href;
        window.location.assign(`${route}/${ref}`);
      };

      document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("table-search-icon").innerHTML = searchIcon;
        document.getElementById("add-product").innerHTML =
          plusIcon + "Add Product";
        document
          .getElementById("table-search")
          .addEventListener("input", (e) => {
            const value = e.target.value.toLowerCase().trim();
            let filteredRows;
            if (value.charAt(0) === "#") {
              filteredRows = rows.filter((i) =>
                i.ref.toLowerCase().startsWith(value.substring(1))
              );
            } else {
              filteredRows = rows.filter((i) =>
                i.name.toLowerCase().startsWith(value)
              );
            }
            setTableRows(filteredRows);
          });
      });
    </script>
    <link rel="stylesheet" th:href="@{/css/erp/table.css}" />
  </head>
  <body>
    <main layout:fragment="content">
      <div class="main-title">
        <h1>Products</h1>
      </div>
      <div class="table-card">
        <div class="table-actions">
          <div
            th:replace="~{fragments/searchbar :: searchbar(prefix = 'table')}"
          />
          <button id="add-product" class="button button-accent" />
        </div>
        <div class="table-wrapper">
          <table id="table" class="table">
            <thead class="thead">
              <tr>
                <th>Name</th>
                <th>Ref</th>
                <th>Price</th>
                <th class="align-right">Status</th>
              </tr>
            </thead>
            <tbody id="table-data" class="tbody pointer">
              <tr
                th:each="row : ${data}"
                th:attr="onclick=|handleRowClick('${row.ref}')|"
              >
                <td th:text="${row.name}" />
                <td th:text="${'# ' + row.ref}" />
                <td th:text="${'$ ' + row.price}" />
                <td align="right">
                  <span
                    th:class="${row.isForSale ? 'badge badge-positive' : 'badge badge-negative'}"
                    th:text="${row.isForSale} ? 'For Sale' : 'Not For Sale'"
                  />
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </body>
</html>
